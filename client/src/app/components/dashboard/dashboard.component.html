<div class="container mt-4">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div
          class="card-header bg-dark d-flex justify-content-between align-items-center"
        >
          <div>
            <h3 class="mb-0">
              <i class="fas fa-tachometer-alt me-2"></i>Inventory Dashboard
            </h3>
            <small class="opacity-75"
              >Last updated: {{ currentTime | date: "medium" }}</small
            >
          </div>
          <div class="d-flex gap-2">
            <button
              class="btn btn-outline-light btn-sm"
              (click)="refreshData()"
              [disabled]="isLoading"
            >
              <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
              Refresh
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="row">
    <div class="col-12 text-center py-5">
      <div class="spinner-border" style="color: #4a6fa5;" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="mt-3 text-muted">Loading dashboard data...</p>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="hasError" class="row">
    <div class="col-12">
      <div class="alert d-flex align-items-center" style="background: linear-gradient(135deg, #f5e6e6 0%, #f0d4d4 100%); border: 1px solid #b85450; color: #721c24;" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <div>
          <strong>Error:</strong> {{ errorMessage }}
          <button
            class="btn btn-sm ms-3 text-white"
            style="background: linear-gradient(135deg, #b85450 0%, #a04a47 100%); border: 1px solid #b85450;"
            (click)="refreshData()"
          >
            <i class="fas fa-redo me-1"></i>Retry
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!isLoading && !hasError">
    <!-- Key Metrics Row -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div
          class="card text-white h-100"
          style="background: linear-gradient(135deg, #4a6fa5 0%, #3d5a8a 100%)"
        >
          <div class="card-body text-center">
            <h4>{{ productAnalytics?.totalProducts || 0 }}</h4>
            <p class="mb-0">Total Products</p>
            <small class="opacity-75"
              >{{ productAnalytics?.activeProducts || 0 }} active</small
            >
          </div>
          <div class="card-footer" style="background: rgba(0, 0, 0, 0.2)">
            <button
              class="btn btn-outline-light btn-sm w-100"
              (click)="navigateToProducts()"
            >
              <i class="fas fa-arrow-right me-1"></i>View Products
            </button>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div
          class="card text-white h-100"
          style="background: linear-gradient(135deg, #5a8a5e 0%, #4a7c59 100%)"
        >
          <div class="card-body text-center">
            <h4>{{ totalInventoryValue | currency }}</h4>
            <p class="mb-0">Total Inventory Value</p>
            <small class="opacity-75">{{ warehouseCount }} warehouses</small>
          </div>
          <div class="card-footer" style="background: rgba(0, 0, 0, 0.2)">
            <button
              class="btn btn-outline-light btn-sm w-100"
              (click)="navigateToWarehouses()"
            >
              <i class="fas fa-arrow-right me-1"></i>View Warehouses
            </button>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div
          class="card text-white h-100"
          [style]="
            lowStockCount > 0
              ? 'background: linear-gradient(135deg, #b85450 0%, #a04a47 100%);'
              : 'background: linear-gradient(135deg, #4a6fa5 0%, #3d5a8a 100%);'
          "
        >
          <div class="card-body text-center">
            <h4>{{ lowStockCount }}</h4>
            <p class="mb-0">Low Stock Items</p>
            <small class="opacity-75">{{ highStockCount }} overstock</small>
          </div>
          <div class="card-footer" style="background: rgba(0, 0, 0, 0.2)">
            <button
              class="btn btn-outline-light btn-sm w-100"
              (click)="navigateToStock()"
            >
              <i class="fas fa-arrow-right me-1"></i>Manage Stock
            </button>
          </div>
        </div>
      </div>

      <div class="col-md-3">
        <div
          class="card text-white h-100"
          [style]="
            inventoryHealthScore >= 80
              ? 'background: linear-gradient(135deg, #5a8a5e 0%, #4a7c59 100%);'
              : inventoryHealthScore >= 60
                ? 'background: linear-gradient(135deg, #d4935c 0%, #c08347 100%);'
                : 'background: linear-gradient(135deg, #b85450 0%, #a04a47 100%);'
          "
        >
          <div class="card-body text-center">
            <h4>{{ inventoryHealthScore }}%</h4>
            <p class="mb-0">Health Score</p>
            <small class="opacity-75">Inventory status</small>
          </div>
          <div class="card-footer" style="background: rgba(0, 0, 0, 0.2)">
            <button
              class="btn btn-outline-light btn-sm w-100"
              (click)="navigateToReports()"
            >
              <i class="fas fa-arrow-right me-1"></i>View Reports
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Alerts and Actions Row -->
    <div class="row mb-4" *ngIf="lowStockCount > 0 || highStockCount > 0">
      <div class="col-12">
        <div class="card" style="border: 2px solid #d4935c">
          <div
            class="card-header text-white"
            style="
              background: linear-gradient(135deg, #d4935c 0%, #c08347 100%);
            "
          >
            <h5 class="mb-0">
              <i class="fas fa-bell me-2"></i>Attention Required
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6" *ngIf="lowStockCount > 0">
                <div class="alert mb-0" style="background: linear-gradient(135deg, #f5e6e6 0%, #f0d4d4 100%); border: 1px solid #b85450; color: #721c24;">
                  <h6>
                    <i class="fas fa-exclamation-triangle me-2"></i>Low Stock
                    Alert
                  </h6>
                  <p class="mb-2">
                    {{ lowStockCount }} products are running low on stock.
                  </p>
                  <button
                    class="btn btn-sm text-white"
                    style="background: linear-gradient(135deg, #b85450 0%, #a04a47 100%);"
                    (click)="navigateToStock()"
                  >
                    <i class="fas fa-eye me-1"></i>Review Low Stock
                  </button>
                </div>
              </div>
              <div class="col-md-6" *ngIf="highStockCount > 0">
                <div class="alert mb-0" style="background: linear-gradient(135deg, #f9f3e8 0%, #f5ead1 100%); border: 1px solid #d4935c; color: #8b4513;">
                  <h6><i class="fas fa-boxes me-2"></i>Overstock Notice</h6>
                  <p class="mb-2">
                    {{ highStockCount }} products have excess inventory.
                  </p>
                  <button
                    class="btn btn-sm text-white"
                    style="background: linear-gradient(135deg, #d4935c 0%, #c08347 100%);"
                    (click)="navigateToStock()"
                  >
                    <i class="fas fa-eye me-1"></i>Review Overstock
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Analytics Row -->
    <div class="row mb-4">
      <!-- Product Categories -->
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-tags me-2"></i>Top Product Categories
            </h5>
          </div>
          <div class="card-body">
            <div *ngIf="topCategories.length > 0; else noCategories">
              <div class="mb-3" *ngFor="let category of topCategories">
                <div
                  class="d-flex justify-content-between align-items-center mb-1"
                >
                  <span class="fw-medium">{{ category.key }}</span>
                  <span class="badge text-white" style="background: linear-gradient(135deg, #4a6fa5 0%, #3d5a8a 100%);">{{ category.value }}</span>
                </div>
                <div class="progress" style="height: 8px">
                  <div
                    class="progress-bar"
                    style="background: linear-gradient(135deg, #4a6fa5 0%, #3d5a8a 100%);"
                    [style.width.%]="
                      (category.value /
                        (productAnalytics?.totalProducts || 1)) *
                      100
                    "
                  ></div>
                </div>
              </div>
            </div>
            <ng-template #noCategories>
              <p class="text-muted text-center py-3">
                No category data available
              </p>
            </ng-template>
          </div>
          <div class="card-footer">
            <button
              class="btn btn-sm w-100 text-white"
              style="background: linear-gradient(135deg, #4a6fa5 0%, #3d5a8a 100%); border: 1px solid #4a6fa5;"
              (click)="navigateToProducts()"
            >
              <i class="fas fa-chart-bar me-1"></i>View All Categories
            </button>
          </div>
        </div>
      </div>

      <!-- Critical Stock Items -->
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-exclamation-circle me-2"></i>Critical Stock Items
            </h5>
          </div>
          <div class="card-body">
            <div *ngIf="criticalStockItems.length > 0; else noCriticalItems">
              <div class="list-group list-group-flush">
                <div
                  class="list-group-item px-0 py-2"
                  *ngFor="let item of criticalStockItems"
                >
                  <div
                    class="d-flex justify-content-between align-items-center"
                  >
                    <div>
                      <h6 class="mb-1">{{ item.productName }}</h6>
                      <small class="text-muted">{{ item.productCode }}</small>
                    </div>
                    <div class="text-end">
                      <span class="badge text-white" style="background: linear-gradient(135deg, #b85450 0%, #a04a47 100%);">{{ item.quantity }}</span>
                      <small class="text-muted d-block">in stock</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #noCriticalItems>
              <div class="text-center py-3">
                <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                <p class="text-muted mb-0">All stock levels are healthy!</p>
              </div>
            </ng-template>
          </div>
          <div class="card-footer">
            <button
              class="btn btn-sm w-100 text-white"
              style="background: linear-gradient(135deg, #b85450 0%, #a04a47 100%); border: 1px solid #b85450;"
              (click)="navigateToStock()"
            >
              <i class="fas fa-list me-1"></i>View All Stock Levels
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions Row -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0"><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-3">
                <button
                  class="btn w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3 text-white"
                  style="background: linear-gradient(135deg, #4a6fa5 0%, #3d5a8a 100%); border: 2px solid #4a6fa5;"
                  (click)="navigateToProducts()"
                >
                  <i class="fas fa-plus-circle fa-2x mb-2"></i>
                  <span>Add New Product</span>
                </button>
              </div>
              <div class="col-md-3">
                <button
                  class="btn w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3 text-white"
                  style="background: linear-gradient(135deg, #5a8a5e 0%, #4a7c59 100%); border: 2px solid #5a8a5e;"
                  (click)="navigateToWarehouses()"
                >
                  <i class="fas fa-warehouse fa-2x mb-2"></i>
                  <span>Manage Warehouses</span>
                </button>
              </div>
              <div class="col-md-3">
                <button
                  class="btn w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3 text-white"
                  style="background: linear-gradient(135deg, #d4935c 0%, #c08347 100%); border: 2px solid #d4935c;"
                  (click)="navigateToStock()"
                >
                  <i class="fas fa-boxes fa-2x mb-2"></i>
                  <span>Update Stock</span>
                </button>
              </div>
              <div class="col-md-3">
                <button
                  class="btn w-100 h-100 d-flex flex-column align-items-center justify-content-center py-3 text-white"
                  style="background: linear-gradient(135deg, #4a6fa5 0%, #3d5a8a 100%); border: 2px solid #4a6fa5;"
                  (click)="navigateToReports()"
                >
                  <i class="fas fa-chart-line fa-2x mb-2"></i>
                  <span>Generate Reports</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Summary Stats Row -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="fas fa-chart-pie me-2"></i>Inventory Summary
            </h5>
          </div>
          <div class="card-body">
            <div class="row text-center">
              <div class="col-md-2">
                <div class="border-end">
                  <h4 style="background: linear-gradient(135deg, #4a6fa5 0%, #3d5a8a 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    {{ productAnalytics?.categoriesCount || 0 }}
                  </h4>
                  <small class="text-muted">Categories</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="border-end">
                  <h4 style="background: linear-gradient(135deg, #4a6fa5 0%, #3d5a8a 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    {{ productAnalytics?.brandsCount || 0 }}
                  </h4>
                  <small class="text-muted">Brands</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="border-end">
                  <h4 style="background: linear-gradient(135deg, #5a8a5e 0%, #4a7c59 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    {{ productAnalytics?.averagePrice | currency }}
                  </h4>
                  <small class="text-muted">Avg. Price</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="border-end">
                  <h4 style="background: linear-gradient(135deg, #d4935c 0%, #c08347 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    {{ aggregateData?.stockLevels?.totalStockEntries || 0 }}
                  </h4>
                  <small class="text-muted">Stock Entries</small>
                </div>
              </div>
              <div class="col-md-2">
                <div class="border-end">
                  <h4 style="background: linear-gradient(135deg, #b85450 0%, #a04a47 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                    {{ productAnalytics?.inactiveProducts || 0 }}
                  </h4>
                  <small class="text-muted">Inactive Products</small>
                </div>
              </div>
              <div class="col-md-2">
                <h4 style="background: linear-gradient(135deg, #4a6fa5 0%, #3d5a8a 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">{{ warehouseCount }}</h4>
                <small class="text-muted">Warehouses</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
